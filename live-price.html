<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>🔔 실시간 현재가</title>
  <style>
    body { font-family:sans-serif; padding:1rem; }
    #price { font-size:1.5rem; margin-top:2rem; }
    a { display:block; margin-top:1rem; color:#06c; }
  </style>
</head>
<body>
  <h1>🔔 실시간 현재가</h1>
  <div id="price">현재가: -</div>
  <a href="exchange.html">← 설정 페이지로 돌아가기</a>

  <script>
    const priceEl = document.getElementById('price');
    let timer;

    async function fetchPrice() {
      const ex   = localStorage.getItem('exchange') || 'upbit';
      const coin = localStorage.getItem('coin')     || 'BTC';
      let url, res, js, price;

      try {
        if (ex === 'upbit') {
          url = `https://api.upbit.com/v1/ticker?markets=KRW-${coin}`;
          res = await fetch(url);
          js  = await res.json();
          price = js[0].trade_price;
          priceEl.innerText = `현재가: ${price.toLocaleString()} KRW`;

        } else if (ex === 'binance') {
          url = `https://api.binance.com/api/v3/ticker/price?symbol=${coin}USDT`;
          res = await fetch(url);
          js  = await res.json();
          price = parseFloat(js.price);
          priceEl.innerText = `현재가: ${price.toLocaleString()} USDT`;

        } else if (ex === 'bitget') {
          url = `https://api.bitget.com/api/spot/v1/market/ticker?symbol=${coin}USDT`;
          res = await fetch(url);
          js  = await res.json();
          // Bitget 성공 코드인 '00000' 체크
          if (js.code !== '00000' || !js.data || !js.data.last) {
            throw new Error('BitgetError');
          }
          price = parseFloat(js.data.last);
          priceEl.innerText = `현재가: ${price.toLocaleString()} USDT`;
        }
      } catch {
        priceEl.innerText = '현재가: (불러오기 실패)';
      }
    }

    function start() {
      fetchPrice();
      timer = setInterval(fetchPrice, 2000);
    }

    window.addEventListener('load', start);
  </script>
</body>
</html>