<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ğŸ”” ì‹¤ì‹œê°„ í˜„ì¬ê°€</title>
  <style>
    body { font-family:sans-serif; padding:1rem; }
    #price { font-size:1.5rem; margin-top:2rem; }
    a { display:block; margin-top:1rem; color:#06c; }
  </style>
</head>
<body>
  <h1>ğŸ”” ì‹¤ì‹œê°„ í˜„ì¬ê°€</h1>
  <div id="price">í˜„ì¬ê°€: -</div>
  <a href="exchange.html">â† ì„¤ì • í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>

  <script>
    const priceEl = document.getElementById('price');
    let timer;

    async function fetchPrice() {
      const ex   = localStorage.getItem('exchange') || 'upbit';
      const coin = localStorage.getItem('coin')     || 'BTC';
      let url, res, js, price;

      try {
        if (ex === 'upbit') {
          url = `https://api.upbit.com/v1/ticker?markets=KRW-${coin}`;
          res = await fetch(url);
          js  = await res.json();
          price = js[0].trade_price;
          priceEl.innerText = `í˜„ì¬ê°€: ${price.toLocaleString()} KRW`;

        } else if (ex === 'binance') {
          url = `https://api.binance.com/api/v3/ticker/price?symbol=${coin}USDT`;
          res = await fetch(url);
          js  = await res.json();
          price = parseFloat(js.price);
          priceEl.innerText = `í˜„ì¬ê°€: ${price.toLocaleString()} USDT`;

        } else if (ex === 'bitget') {
          url = `https://api.bitget.com/api/spot/v1/market/ticker?symbol=${coin}USDT`;
          res = await fetch(url);
          js  = await res.json();
          // Bitget ì„±ê³µ ì½”ë“œì¸ '00000' ì²´í¬
          if (js.code !== '00000' || !js.data || !js.data.last) {
            throw new Error('BitgetError');
          }
          price = parseFloat(js.data.last);
          priceEl.innerText = `í˜„ì¬ê°€: ${price.toLocaleString()} USDT`;
        }
      } catch {
        priceEl.innerText = 'í˜„ì¬ê°€: (ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨)';
      }
    }

    function start() {
      fetchPrice();
      timer = setInterval(fetchPrice, 2000);
    }

    window.addEventListener('load', start);
  </script>
</body>
</html>